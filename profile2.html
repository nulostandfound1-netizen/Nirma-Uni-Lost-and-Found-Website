
<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <title>Lost and Found - Nirma University</title>

    <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@300;400;600;700;900&display=swap"
        rel="stylesheet">

    <style>
        :root {
            --primary: #e60000;
            --light-bg: #f1f3f4;
            --box-bg: #d8d6d6;
            --shadow: 0px 4px 6px rgba(0, 0, 0, 0.2);
            --radius: 10px;
        }

        .con {
            font-size: 0.87vw;
        }

        td h3.con {
            font-size: 0.9vw;
            /* CHANGED: Allow text to wrap normally */
            white-space: normal;
            word-wrap: break-word;
            line-height: 1.4;
            /* Improve readability for 50 words */
            text-align: left;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: "Plus Jakarta Sans", sans-serif;
        }

        body {
            background-color: var(--light-bg);
        }

        header {
            height: 10vh;
            background-color: #ffffff;
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0 30px;
            box-shadow: var(--shadow);
        }

        .img {
            height: 50%;
            width: 60%;
            align-content: center;
            object-fit: cover;
        }

        .title {
            text-align: center;
            align-content: center;
        }

        .title h1 {
            color: var(--primary);
            font-size: 1.9vw;
            font-weight: 900;
        }

        .title h2 {
            font-size: 1.3vw;
            font-weight: 600;
        }

        .header-actions {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        #logout,
        .back {
            padding: 8px 20px;
            border: 2px solid gray;
            border-radius: var(--radius);
            background-color: #e1e1e1;
            font-weight: 600;
            cursor: pointer;
            transition: 0.2s;
            text-decoration: none;
            color: black;
            display: inline-block;
        }

        #logout:hover,
        .back:hover {
            transform: translateY(-3px);
            box-shadow: var(--shadow);
        }

        main {
            display: flex;
            gap: 15px;
            padding: 15px;
        }

        aside {
            width: 25%;
            background-color: #fff;
            border-radius: var(--radius);
            box-shadow: var(--shadow);
            padding: 20px;
            text-align: center;
        }

        section {
            width: 75%;
            background-color: #fff;
            border-radius: var(--radius);
            box-shadow: var(--shadow);
            padding: 20px;
        }

        aside img {
            border-radius: 50%;
            margin-bottom: 15px;
            height: 14vh;
        }

        .reported {
            margin-top: 20px;
            background-color: var(--primary);
            color: white;
            padding: 10px;
            border-radius: var(--radius);
            font-weight: 600;
        }

        .stats {
            display: flex;
            justify-content: space-around;
            margin-bottom: 30px;
        }

        .box {
            width: 150px;
            height: 90px;
            background-color: var(--box-bg);
            border-radius: 15px;
            border: 2px solid #000;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            font-weight: 600;
        }

        .activity h2 {
            margin-bottom: 15px;
        }

        .buttons {
            display: flex;
            gap: 20px;
        }

        .btn {
            padding: 10px 15px;
            border: 2px solid var(--primary);
            border-radius: var(--radius);
            background-color: var(--box-bg);
            font-weight: 600;
            cursor: pointer;
            transition: 0.2s;
            text-align: center;
            color: black;
            text-decoration: none;
        }

        .btn:hover {
            transform: translateY(-3px);
            box-shadow: var(--shadow);
        }

        #removebtn {
            padding: 10px 15px;
            margin-left: 20.4vw;
            border: 2px solid white;
            border-radius: var(--radius);
            background-color: red;
            font-weight: 600;
            cursor: pointer;
            transition: 0.2s;
            text-align: center;
            color: rgb(255, 255, 255);
            text-decoration: none;
            outline: none;
        }

        #removebtn:hover {
            background-color: #ff0000;
            transform: translateY(-3px);
            box-shadow: var(--shadow);
        }

        .bottom1 {
            width: 98%;
            margin: 0 auto;
            display: grid;
            /* CHANGED: Increased height to 520px to fit long text */
            grid-auto-rows: 490px;
            grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
            gap: 20px;
            overflow-y: auto;
            scrollbar-width: none;
            padding-bottom: 20px;
        }

        /* Ensure bottom1 is visible by default if needed, or controlled by JS */
        .bottom1 {
            display: grid;
            /* Or whatever your default state is */
        }

        .bottom {
            border-top-left-radius: 20px;
            border-top-right-radius: 20px;
            height: 55vh;
            width: 98vw;
            text-align: center;
            /* CHANGED: Use Flexbox to manage vertical space */
            display: flex;
            flex-direction: column;
            margin-left: 1%;
            margin-right: 1%;
            overflow: hidden;
            box-shadow: var(--shadow);
            /* Ensures nothing spills out of the grey box */
        }

        
        .dabba2 a {
            width: 100%;
            display: flex;
            justify-content: center;
            margin-bottom: 10px;
            /* Space from bottom */
            text-decoration: none;
            /* Removes underline */
        }
        
        table {
            height: 28%;
        }
          .dabba2 {
                height: 100%;
                width: 100%;
                display: flex;
                flex-direction: column;
                justify-content: space-between;
                /* Pushes button to bottom */
            }
    
            .dabba {
                background-color: white;
                border-radius: 20px;
                box-shadow: 0px 4px 6px rgba(0, 0, 0, 0.2);
                /* CHANGED: Remove fixed height. Use flex: 1 to fill space */
                height: 50vh;
    
                width: 93%;
                margin: 0 auto 10px auto;
                /* Adds space between white card and button */
                padding: 10px;
                /* Add padding so text doesn't touch edges */
    
                display: flex;
                flex-direction: column;
                align-items: center;
                overflow: hidden;
                /* Keeps content inside the rounded corners */

                animation : appear linear;
                animation-timeline : view(); 
                animation-range : entry 0% cover 30%;
            }

        @keyframes appear{
            from {
                opacity : 0;
                scale: 0.5;
            }
            to{
                opacity : 1;
                scale : 1;
            }
        }

        /* Visual cue for when selection mode is active */
        .selecting-mode .dabba2 {
            cursor: pointer;
            position: relative;
            transition: transform 0.2s;
        }

        .selecting-mode .dabba2:hover {
            transform: scale(1.02);
        }

        /* Style for a selected card */
        .dabba2.selected-for-removal .dabba {
            border: 3px solid var(--primary);
            background-color: #fff0f0;
        }

        /* Optional: Add a checkmark or indicator */
        .selected-for-removal::after {
            content: "✓";
            position: absolute;
            top: 10px;
            right: 20px;
            background: var(--box-bg);
            color: white;
            border-radius: 50%;
            width: 25px;
            height: 25px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
        }

        @media (max-width: 768px) {
            main {
                flex-direction: column;
            }

            aside,
            section {
                width: 100%;
            }

            .stats {
                flex-direction: column;
                gap: 15px;
                align-items: center;
            }

            .buttons {
                flex-direction: column;
                width: 100%;
            }

            .btn {
                width: 100%;
            }
        }
    </style>
</head>

<body>

    <header>
        <div class="title">
            <h1>Nirma University</h1>
            <h2>Lost and Found</h2>
        </div>

        <div class="header-actions">
            <a href="homepage.html" class="back">←Back</a>
            <button id="logout">Logout</button>
        </div>
    </header>

    <main>
        <aside>
            <img alt="User Profile Picture" id=image onerror="this.src='https:\/\/www.shutterstock.com/image-vector/user-profile-icon-vector-avatar-600nw-2558760599.jpg'">
            <h2 id=RNo>Roll No</h2>
            <p id=mail>Email ID</p>

        </aside>

        <section>
            <div class="stats">
                <div class="box">Reported Lost<br><b id=lostNum>0</b></div>
                <div class="box">Reported Found<br><b id=foundNum>0</b></div>
            </div>

            <hr><br>

            <div class="activity">
                <div class="buttons">
                    <a href="lostform.html" class="btn">+ Report New Lost Item</a>
                    <a href="foundform.html" class="btn">+ Report New Found Item</a>
                    <div id="removebtn"> Remove Items</div>
                </div>
            </div>
        </section>
    </main>
    <div class="bottom">
        <div class="bottom1">

        </div>
    </div>
    <div>

    </div>
    <script type="module">
        /* ------------------ IMPORTS ------------------ */
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { getDatabase, ref, get, remove } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-database.js";
        import { getAuth, signOut } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";

        /* ------------------ FIREBASE CONFIG ------------------ */
        const firebaseConfig = {
            apiKey: "AIzaSyAuXnFXE9KtuzoAhcixtMYBcVtHfYs8OFQ",
            authDomain: "nu-lost-and-found.firebaseapp.com",
            projectId: "nu-lost-and-found",
            storageBucket: "nu-lost-and-found.firebasestorage.app",
            messagingSenderId: "905343956080",
            appId: "1:905343956080:web:90f00a87311987e360b0b5"
        };

        const app = initializeApp(firebaseConfig);
        const db = getDatabase(app);
        const auth = getAuth(app);

        /* ------------------ USER INFO ------------------ */
        const userMail = localStorage.getItem("mail");
        const safeMail = userMail.replaceAll('.', ',');

        /* ------------------ LOGOUT ------------------ */
        document.getElementById("logout").addEventListener("click", () => {
            signOut(auth).then(() => {
                alert("Signed out successfully");
                window.location.href = "LoginPage.html";
            });
        });

        /* ------------------ PROFILE ------------------ */
        document.getElementById("RNo").innerText = userMail.slice(0, 8);
        document.getElementById("mail").innerText = userMail;

        const storedPic = localStorage.getItem("pic");
        document.getElementById("image").src =
            storedPic && storedPic !== "null"
                ? storedPic
                : "https://cdn-icons-png.flaticon.com/512/847/847969.png";

        /* ------------------ GLOBALS ------------------ */
        const bottom = document.querySelector(".bottom1");
        let lostCount = 0;
        let foundCount = 0;
        let html = "";

        /* ------------------ CARD TEMPLATE ------------------ */
        function createCard(data, id, type) {
            return `
    <div class="dabba2"
         data-id="${id}"
         data-type="${type}"
         data-mail="${safeMail}">
        <div class="dabba">
            <img src="${data.image_url}" class="img">
            <table>
                <tr><td><b>Item:</b></td><td>${data.item}</td></tr>
                <tr><td><b>Name:</b></td><td>${data.name}</td></tr>
                <tr><td><b>Description:</b></td><td>${data.description}</td></tr>
                <tr><td><b>Date:</b></td><td>${data.date_found}</td></tr>
                <tr><td><b>Location:</b></td><td>${data.place_found}</td></tr>
                <tr>
                    <td colspan="2" align="center"><br>
                        <span style="background:${type === 'seeker' ? 'red' : 'green'};
                                     color:white; padding:4px 8px;
                                     border-radius:5px;">
                            ${type}
                        </span>
                    </td>
                </tr>
            </table>
        </div>
    </div>`;
        }

        /* ------------------ LOAD SEEKERS ------------------ */
        get(ref(db, "Seekers/" + safeMail)).then(snapshot => {
            if (!snapshot.exists()) return;

            snapshot.forEach(child => {
                html += createCard(child.val(), child.key, "seeker");
                lostCount++;
            });

            document.getElementById("lostNum").innerText = lostCount;
            bottom.innerHTML = html;
        });

        /* ------------------ LOAD FOUNDERS ------------------ */
        get(ref(db, "founders/" + safeMail)).then(snapshot => {
            if (!snapshot.exists()) return;

            snapshot.forEach(child => {
                html += createCard(child.val(), child.key, "founder");
                foundCount++;
            });

            document.getElementById("foundNum").innerText = foundCount;
            bottom.innerHTML = html;
        });

        /* ------------------ REMOVE MODE ------------------ */
        const removeBtn = document.getElementById("removebtn");
        let selecting = false;
        let selectedCards = new Set();

        removeBtn.addEventListener("click", () => {
            selecting = !selecting;

            if (!selecting) {
                if (selectedCards.size > 0 && confirm("Delete selected items?")) {
                    deleteSelected();
                }
                resetSelection();
                return;
            }

            alert("Click items to select for deletion");
            removeBtn.innerText = "Confirm Delete (0)";
        });

        /* ------------------ CARD SELECTION ------------------ */
        bottom.addEventListener("click", e => {
            if (!selecting) return;

            const card = e.target.closest(".dabba2");
            if (!card) return;

            card.classList.toggle("selected-for-removal");

            if (card.classList.contains("selected-for-removal")) {
                selectedCards.add(card);
            } else {
                selectedCards.delete(card);
            }

            removeBtn.innerText = `Confirm Delete (${selectedCards.size})`;
        });

        /* ------------------ DELETE ------------------ */
        function deleteSelected() {
            selectedCards.forEach(card => {
                const id = card.dataset.id;
                const type = card.dataset.type;
                const mail = card.dataset.mail;

                const path =
                    type === "seeker"
                        ? `Seekers/${mail}/${id}`
                        : `founders/${mail}/${id}`;

                remove(ref(db, path));
            });

            location.reload();
        }

        /* ------------------ RESET ------------------ */
        function resetSelection() {
            selecting = false;
            selectedCards.clear();
            removeBtn.innerText = "Remove Items";

            document.querySelectorAll(".selected-for-removal")
                .forEach(el => el.classList.remove("selected-for-removal"));
        }
</script>
</body>

</html>